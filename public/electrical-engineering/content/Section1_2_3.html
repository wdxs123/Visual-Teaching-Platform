<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电感元件交互学习平台</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #ffffff;
            color: #333333;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 1100px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid #e0e0e0;
            transition: transform 0.3s ease;
        }
        
        .panel:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        
        .panel-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #2c3e50;
            position: relative;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        .panel-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: #3498db;
            border-radius: 3px;
        }
        
        #visualization {
            height: 400px;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            background: #ffffff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e0e0e0;
        }
        
        #graph-container {
            height: 280px;
            margin-top: 20px;
            background: #ffffff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e0e0e0;
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: #2c3e50;
            font-size: 1rem;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .slider-container input[type="range"] {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: #e0e0e0;
            border-radius: 5px;
            outline: none;
        }
        
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
            border: 2px solid #ffffff;
            transition: transform 0.2s ease;
        }
        
        .slider-container input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }
        
        .value-display {
            min-width: 60px;
            padding: 6px 12px;
            background: #f0f3f7;
            border-radius: 6px;
            text-align: center;
            font-family: monospace;
            font-size: 1rem;
            color: #3498db;
            border: 1px solid #d0e0f0;
        }
        
        .preset-scenarios {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .scenario {
            background: #f0f3f7;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #d0e0f0;
            position: relative;
        }
        
        .scenario:hover {
            transform: translateY(-5px);
            background: #e1f0ff;
            border-color: #3498db;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .scenario::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: #3498db;
        }
        
        .scenario h4 {
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .scenario p {
            line-height: 1.5;
            color: #555555;
            font-size: 0.95rem;
        }
        
        .formula-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid #e0e0e0;
        }
        
        .formula {
            font-size: 1.2rem;
            text-align: center;
            padding: 15px;
            background: #f0f3f7;
            border-radius: 10px;
            margin: 20px 0;
            overflow-x: auto;
            border: 1px solid #d0e0f0;
        }
        
        .formula-item {
            margin: 12px 0;
            padding: 12px;
            background: #ffffff;
            border-radius: 6px;
        }
        
        .explanation {
            background: #f0f3f7;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            line-height: 1.6;
            border: 1px solid #d0e0f0;
        }
        
        .explanation p {
            margin-bottom: 12px;
            font-size: 0.95rem;
        }
        
        .highlight {
            color: #e74c3c;
            font-weight: bold;
            background: rgba(231, 76, 60, 0.1);
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 50%;
        }
        
        .current-color {
            background: #3498db;
        }
        
        .voltage-color {
            background: #e74c3c;
        }
        
        .emf-color {
            background: #9b59b6;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #3498db;
            font-size: 1.1rem;
            z-index: 10;
            text-align: center;
        }
        
        .current-flow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }
        
        .flow-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #3498db;
            border-radius: 50%;
            box-shadow: 0 0 10px #3498db;
            opacity: 0;
            animation: moveParticle 2s linear infinite;
        }
        
        @keyframes moveParticle {
            0% { transform: translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateX(100px); opacity: 0; }
        }
        
        .formula-explanation {
            background: #f0f3f7;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            line-height: 1.6;
            border: 1px solid #d0e0f0;
        }
        
        .formula-explanation h3 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }
        
        .formula-explanation p {
            margin-bottom: 12px;
            font-size: 0.95rem;
        }
        
        .info-badge {
            display: inline-block;
            background: #e1f0ff;
            color: #3498db;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin: 10px 0;
            border: 1px solid #d0e0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="content">
            <div class="panel">
                <h2 class="panel-title">电感元件可视化</h2>
                <div id="visualization">
                    <div class="loading">正在加载3D可视化...</div>
                    <div class="info-badge">提示：拖拽可旋转视角，滚轮可缩放 | 粒子束流显示电流方向</div>
                    <div class="current-flow" id="current-flow"></div>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color current-color"></div>
                        <span>电流方向</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color voltage-color"></div>
                        <span>电压方向</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color emf-color"></div>
                        <span>自感电动势方向</span>
                    </div>
                </div>
                
                <div id="graph-container">
                    <canvas id="waveform-chart"></canvas>
                </div>
            </div>
            
            <div class="panel">
                <h2 class="panel-title">参数控制面板</h2>
                
                <div class="controls">
                    <div class="control-group">
                        <label for="inductance">电感值 L (亨利)</label>
                        <div class="slider-container">
                            <input type="range" id="inductance" min="0.1" max="5" step="0.1" value="1">
                            <div class="value-display" id="inductance-value">1.0 H</div>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label for="initial-current">初始电流 i(t₀) (安培)</label>
                        <div class="slider-container">
                            <input type="range" id="initial-current" min="-5" max="5" step="0.1" value="0">
                            <div class="value-display" id="initial-current-value">0.0 A</div>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label for="di-dt">电流变化率 di/dt (安培/秒)</label>
                        <div class="slider-container">
                            <input type="range" id="di-dt" min="-10" max="10" step="0.1" value="0">
                            <div class="value-display" id="di-dt-value">0.0 A/s</div>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label for="time">时间 t (秒)</label>
                        <div class="slider-container">
                            <input type="range" id="time" min="0" max="10" step="0.1" value="0">
                            <div class="value-display" id="time-value">0.0 s</div>
                        </div>
                    </div>
                </div>
                
                <h3 class="panel-title">预设场景</h3>
                <div class="preset-scenarios">
                    <div class="scenario" id="scenario1">
                        <h4>情况 1</h4>
                        <p>电流方向与参考方向相同，绝对值增加</p>
                        <p>i > 0, di/dt > 0</p>
                    </div>
                    
                    <div class="scenario" id="scenario2">
                        <h4>情况 2</h4>
                        <p>电流方向与参考方向相同，绝对值减少</p>
                        <p>i > 0, di/dt < 0</p>
                    </div>
                    
                    <div class="scenario" id="scenario3">
                        <h4>情况 3</h4>
                        <p>电流方向与参考方向相反，绝对值增加</p>
                        <p>i < 0, di/dt < 0</p>
                    </div>
                    
                    <div class="scenario" id="scenario4">
                        <h4>情况 4</h4>
                        <p>电流方向与参考方向相反，绝对值减少</p>
                        <p>i < 0, di/dt > 0</p>
                    </div>
                </div>
                
                <div class="formula-section">
                    <h3 class="panel-title">核心公式</h3>
                    
                    <div class="formula">
                        <div class="formula-item">
                            自感电动势: \( e_L = -L \frac{di}{dt} \)
                        </div>
                        <div class="formula-item">
                            电感电压: \( u_L = -e_L = L \frac{di}{dt} \)
                        </div>
                    </div>
                    
                    <div class="formula-explanation">
                        <h3>公式含义解释</h3>
                        <p><span class="highlight">e<sub>L</sub></span>：自感电动势，单位伏特(V)</p>
                        <p><span class="highlight">u<sub>L</sub></span>：电感两端电压，单位伏特(V)</p>
                        <p><span class="highlight">L</span>：电感值，单位亨利(H)</p>
                        <p><span class="highlight">di/dt</span>：电流变化率，单位安培/秒(A/s)</p>
                        <p>负号表示自感电动势的方向总是阻碍电流的变化</p>
                    </div>
                    
                    <div class="explanation">
                        <h3>根据公式推导</h3>
                        <p>当 <span class="highlight">di/dt > 0</span> 时：</p>
                        <p>\( e_L = -L \times (\text{正数}) < 0 \) → 自感电动势极性与参考极性<span class="highlight">相反</span></p>
                        <p>当 <span class="highlight">di/dt < 0</span> 时：</p>
                        <p>\( e_L = -L \times (\text{负数}) > 0 \) → 自感电动势极性与参考极性<span class="highlight">相同</span></p>
                        
                        <div style="margin-top: 15px;">
                            <p><span class="highlight">物理意义</span>：自感电动势总是阻碍电流的变化。当电流增大时，自感电动势方向与电流方向相反；当电流减小时，自感电动势方向与电流方向相同。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 初始化Three.js场景
        let scene, camera, renderer, inductor, currentArrow, voltageArrow, emfArrow;
        let controls;
        let currentParticles = [];
        
        // 创建电流粒子
        function createCurrentParticles() {
            const container = document.getElementById('current-flow');
            const particleCount = 40;
            
            // 清除现有粒子
            if (currentParticles.length > 0) {
                currentParticles.forEach(p => p.remove());
            }
            currentParticles = [];
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('flow-particle');
                particle.style.opacity = '0';
                
                // 设置随机位置
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                
                container.appendChild(particle);
                currentParticles.push(particle);
            }
        }
        
        // 更新电流粒子
        function updateCurrentParticles(direction) {
            const container = document.getElementById('current-flow');
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            
            currentParticles.forEach((particle, index) => {
                // 随机位置
                const x = Math.random() * containerWidth;
                const y = Math.random() * containerHeight;
                
                // 粒子动画
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.opacity = '0.8';
                
                // 设置动画延迟
                particle.style.animationDelay = `${index * 0.05}s`;
            });
        }
        
        function initThreeJS() {
            try {
                // 创建场景
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0xf0f0f0);
                
                // 创建相机
                const vizElement = document.getElementById('visualization');
                camera = new THREE.PerspectiveCamera(75, vizElement.offsetWidth / vizElement.offsetHeight, 0.1, 1000);
                camera.position.z = 8;
                camera.position.y = 3;
                
                // 创建渲染器
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(vizElement.offsetWidth, vizElement.offsetHeight);
                vizElement.appendChild(renderer.domElement);
                
                // 添加光源
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(5, 10, 7);
                scene.add(directionalLight);
                
                // 创建电感线圈
                createInductor();
                
                // 创建方向箭头
                createArrows();
                
                // 添加坐标轴辅助
                const axesHelper = new THREE.AxesHelper(3);
                scene.add(axesHelper);
                
                // 添加轨道控制器
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.enableZoom = true;
                controls.enablePan = false;
                
                // 移除加载提示
                const loadingElement = document.querySelector('.loading');
                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }
                
                // 动画循环
                function animate() {
                    requestAnimationFrame(animate);
                    controls.update();
                    renderer.render(scene, camera);
                }
                
                animate();
                
                // 响应窗口大小变化
                window.addEventListener('resize', () => {
                    camera.aspect = vizElement.offsetWidth / vizElement.offsetHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(vizElement.offsetWidth, vizElement.offsetHeight);
                });
                
            } catch (error) {
                console.error('Three.js初始化错误:', error);
                const visualization = document.getElementById('visualization');
                visualization.innerHTML = `<div class="error">3D可视化初始化失败: ${error.message}</div>`;
            }
        }
        
        function createInductor() {
            const group = new THREE.Group();
            
            // 创建线圈
            const coilGeometry = new THREE.TorusGeometry(1.5, 0.1, 16, 100);
            const coilMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x3498db,
                metalness: 0.5,
                roughness: 0.4,
                emissive: 0x0044ff,
                emissiveIntensity: 0.1
            });
            
            // 创建多个环组成线圈
            for (let i = 0; i < 10; i++) {
                const coil = new THREE.Mesh(coilGeometry, coilMaterial);
                coil.position.y = i * 0.2 - 0.9;
                coil.rotation.x = Math.PI / 2;
                group.add(coil);
            }
            
            // 创建线圈支架
            const standGeometry = new THREE.CylinderGeometry(0.1, 0.1, 2.5, 16);
            const standMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xaaaaaa,
                metalness: 0.4,
                roughness: 0.6
            });
            
            const stand1 = new THREE.Mesh(standGeometry, standMaterial);
            stand1.position.set(-1.7, 0, 0);
            group.add(stand1);
            
            const stand2 = new THREE.Mesh(standGeometry, standMaterial);
            stand2.position.set(1.7, 0, 0);
            group.add(stand2);
            
            // 创建端点标记
            const endpointGeometry = new THREE.SphereGeometry(0.15, 16, 16);
            const endpointMaterialA = new THREE.MeshStandardMaterial({ 
                color: 0xff5555
            });
            const endpointMaterialB = new THREE.MeshStandardMaterial({ 
                color: 0x55ff55
            });
            
            const endpointA = new THREE.Mesh(endpointGeometry, endpointMaterialA);
            endpointA.position.set(-2.3, 1.2, 0);
            group.add(endpointA);
            
            const endpointB = new THREE.Mesh(endpointGeometry, endpointMaterialB);
            endpointB.position.set(2.3, 1.2, 0);
            group.add(endpointB);
            
            // 添加端点标签
            createLabel('A', -2.6, 1.2, 0);
            createLabel('B', 2.6, 1.2, 0);
            
            scene.add(group);
            inductor = group;
        }
        
        function createLabel(text, x, y, z) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 128;
            canvas.height = 64;
            
            context.fillStyle = '#333333';
            context.font = 'bold 48px Arial';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText(text, canvas.width/2, canvas.height/2);
            
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ 
                map: texture,
                transparent: true
            });
            const sprite = new THREE.Sprite(material);
            sprite.position.set(x, y, z);
            sprite.scale.set(0.5, 0.25, 1);
            
            scene.add(sprite);
        }
        
        function createArrows() {
            // 电流方向箭头（从A到B）
            currentArrow = new THREE.ArrowHelper(
                new THREE.Vector3(1, 0, 0),
                new THREE.Vector3(-3, 1.2, 0),
                2,
                0x3498db,
                0.5,
                0.3
            );
            scene.add(currentArrow);
            
            // 电压方向箭头（从A到B）
            voltageArrow = new THREE.ArrowHelper(
                new THREE.Vector3(1, 0, 0),
                new THREE.Vector3(-3, 0.8, 0),
                2,
                0xe74c3c,
                0.5,
                0.3
            );
            scene.add(voltageArrow);
            
            // 自感电动势方向箭头（从B到A）
            emfArrow = new THREE.ArrowHelper(
                new THREE.Vector3(-1, 0, 0),
                new THREE.Vector3(3, 0.4, 0),
                2,
                0x9b59b6,
                0.5,
                0.3
            );
            scene.add(emfArrow);
        }
        
        // 初始化图表
        let waveformChart;
        
        function initChart() {
            const ctx = document.getElementById('waveform-chart').getContext('2d');
            
            waveformChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: '电流 i(t) (A)',
                            data: [],
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4
                        },
                        {
                            label: '电压 u_L(t) (V)',
                            data: [],
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4
                        },
                        {
                            label: '自感电动势 e_L(t) (V)',
                            data: [],
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '时间 (s)',
                                color: '#666666'
                            },
                            grid: {
                                color: '#f0f0f0'
                            },
                            ticks: {
                                color: '#666666'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '值 (V/A)',
                                color: '#666666'
                            },
                            grid: {
                                color: '#f0f0f0'
                            },
                            ticks: {
                                color: '#666666'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#333333'
                            }
                        }
                    }
                }
            });
        }
        
        // 更新图表数据
        function updateChart(time, current, voltage, emf) {
            const chart = waveformChart.data;
            
            // 添加新数据点
            chart.labels.push(time.toFixed(1));
            chart.datasets[0].data.push(current);
            chart.datasets[1].data.push(voltage);
            chart.datasets[2].data.push(emf);
            
            // 保持最多50个数据点
            if (chart.labels.length > 50) {
                chart.labels.shift();
                chart.datasets[0].data.shift();
                chart.datasets[1].data.shift();
                chart.datasets[2].data.shift();
            }
            
            waveformChart.update();
        }
        
        // 更新箭头方向
        function updateArrows(current, di_dt) {
            // 电流方向
            const currentDirection = current >= 0 ? 1 : -1;
            currentArrow.setDirection(new THREE.Vector3(currentDirection, 0, 0));
            currentArrow.position.set(currentDirection > 0 ? -3 : 3, 1.2, 0);
            
            // 计算自感电动势
            const emf = -parseFloat(document.getElementById('inductance').value) * di_dt;
            
            // 自感电动势方向
            emfArrow.setDirection(new THREE.Vector3(emf >= 0 ? 1 : -1, 0, 0));
            emfArrow.position.set(emf >= 0 ? -3 : 3, 0.4, 0);
            
            // 电压方向与自感电动势相反
            voltageArrow.setDirection(new THREE.Vector3(emf >= 0 ? -1 : 1, 0, 0));
            voltageArrow.position.set(emf >= 0 ? 3 : -3, 0.8, 0);
            
            // 更新电流粒子
            updateCurrentParticles(currentDirection);
        }
        
        // 设置预设场景
        function setScenario(scenario) {
            const initialCurrent = document.getElementById('initial-current');
            const di_dt = document.getElementById('di-dt');
            
            switch(scenario) {
                case 1:
                    initialCurrent.value = 1;
                    di_dt.value = 5;
                    break;
                case 2:
                    initialCurrent.value = 3;
                    di_dt.value = -4;
                    break;
                case 3:
                    initialCurrent.value = -2;
                    di_dt.value = -6;
                    break;
                case 4:
                    initialCurrent.value = -3;
                    di_dt.value = 4;
                    break;
            }
            
            // 触发更新
            initialCurrent.dispatchEvent(new Event('input'));
            di_dt.dispatchEvent(new Event('input'));
        }
        
        // 初始化事件监听器
        function initEventListeners() {
            // 电感值控制
            const inductance = document.getElementById('inductance');
            const inductanceValue = document.getElementById('inductance-value');
            
            inductance.addEventListener('input', function() {
                inductanceValue.textContent = this.value + ' H';
                updateSimulation();
            });
            
            // 初始电流控制
            const initialCurrent = document.getElementById('initial-current');
            const initialCurrentValue = document.getElementById('initial-current-value');
            
            initialCurrent.addEventListener('input', function() {
                initialCurrentValue.textContent = this.value + ' A';
                updateSimulation();
            });
            
            // 电流变化率控制
            const di_dt = document.getElementById('di-dt');
            const di_dtValue = document.getElementById('di-dt-value');
            
            di_dt.addEventListener('input', function() {
                di_dtValue.textContent = this.value + ' A/s';
                updateSimulation();
            });
            
            // 时间控制
            const time = document.getElementById('time');
            const timeValue = document.getElementById('time-value');
            
            time.addEventListener('input', function() {
                timeValue.textContent = this.value + ' s';
                updateSimulation();
            });
            
            // 预设场景
            document.getElementById('scenario1').addEventListener('click', () => setScenario(1));
            document.getElementById('scenario2').addEventListener('click', () => setScenario(2));
            document.getElementById('scenario3').addEventListener('click', () => setScenario(3));
            document.getElementById('scenario4').addEventListener('click', () => setScenario(4));
        }
        
        // 更新模拟
        function updateSimulation() {
            const L = parseFloat(document.getElementById('inductance').value);
            const i0 = parseFloat(document.getElementById('initial-current').value);
            const di_dt = parseFloat(document.getElementById('di-dt').value);
            const t = parseFloat(document.getElementById('time').value);
            
            // 计算当前电流
            const i = i0 + di_dt * t;
            
            // 计算自感电动势和电压
            const eL = -L * di_dt;
            const uL = L * di_dt;
            
            // 更新箭头
            updateArrows(i, di_dt);
            
            // 更新图表
            updateChart(t, i, uL, eL);
        }
        
        // 初始化页面
        window.onload = function() {
            try {
                createCurrentParticles();
                initThreeJS();
                initChart();
                initEventListeners();
                updateSimulation();
                
                // 初始粒子动画
                updateCurrentParticles(1);
            } catch (error) {
                console.error('初始化错误:', error);
            }
        };
    </script>
</body>
</html>
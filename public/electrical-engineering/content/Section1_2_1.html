<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>欧姆定律粒子流学习平台</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f8f9fa;
            color: #343a40;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            max-width: 1400px;
            width: 95%;
            padding: 20px;
            margin: 20px auto;
        }
        
        .content {
            display: flex;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .visualization {
            flex: 1;
            background: #87CEEB; /* 浅蓝色背景 */
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            min-height: 500px;
            position: relative;
            border: 1px solid #dee2e6;
        }
        
        #three-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .info-panel {
            flex: 0 0 400px;
            background: #ffffff; /* 白色背景 */
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid #dee2e6;
        }
        
        .panel-title {
            font-size: 1.6rem;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #4da8da;
            color: #212529;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
        }
        
        .knowledge-points {
            list-style-type: none;
            margin-bottom: 25px;
        }
        
        .knowledge-points li {
            padding: 15px;
            margin-bottom: 15px;
            background: rgba(232, 240, 254, 0.6);
            border-radius: 8px;
            border-left: 4px solid #4da8da;
            transition: all 0.3s ease;
        }
        
        .knowledge-points li:hover {
            background: rgba(207, 226, 255, 0.8);
            transform: translateX(5px);
            border-left-color: #2a6fa5;
        }
        
        .highlight {
            color: #1a759f;
            font-weight: 600;
        }
        
        .controls {
            background: rgba(237, 245, 255, 0.6);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid #dee2e6;
        }
        
        .controls h3 {
            margin-bottom: 15px;
            color: #1a759f;
        }
        
        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .btn {
            background: linear-gradient(to right, #4da8da, #1e88e5);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #b8daff;
        }
        
        .btn:hover {
            background: linear-gradient(to right, #3d98d4, #1976d2);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(77, 168, 218, 0.3);
        }
        
        .btn.active {
            background: linear-gradient(to right, #1e88e5, #0d47a1);
            box-shadow: 0 0 15px rgba(77, 168, 218, 0.4);
        }
        
        .formula-display {
            margin-top: 25px;
            background: rgba(237, 245, 255, 0.6);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .formula {
            font-size: 2.2rem;
            font-family: 'Cambria', serif;
            margin: 15px 0;
            padding: 15px;
            background: linear-gradient(90deg, rgba(77, 168, 218, 0.1), rgba(30, 136, 229, 0.1));
            border-radius: 8px;
            border: 1px solid #dee2e6;
            color: #1a759f;
        }
        
        .formula-legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #dee2e6;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .current-color { 
            background-color: #e74c3c; 
            box-shadow: 0 0 10px #e74c3c;
        }
        .voltage-color { 
            background-color: #3498db;
            box-shadow: 0 0 10px #3498db;
        }
        .particle-color { 
            background-color: #FFA500;
            box-shadow: 0 0 10px #FF8C00;
        }
        
        .speed-control {
            margin-top: 20px;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .slider-container label {
            font-size: 0.9rem;
            color: #495057;
        }
        
        input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            height: 5px;
            background: rgba(77, 168, 218, 0.2);
            border-radius: 5px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #1e88e5;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(30, 136, 229, 0.8);
        }
        
        /* 缩小正负号标志样式 */
        .electrode-label {
            position: absolute;
            font-size: 2.2rem; /* 缩小字号 */
            font-weight: bold;
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: 100;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.9);
        }
        
        .negative-label {
            background: radial-gradient(circle, rgba(255,100,100,0.8) 0%, rgba(200,0,0,0.8) 100%);
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(200, 0, 0, 0.6);
            color: #fff;
        }
        
        .positive-label {
            background: radial-gradient(circle, rgba(100,100,255,0.8) 0%, rgba(0,0,200,0.8) 100%);
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(0, 100, 255, 0.6);
            color: #fff;
        }
        
        .particle-description {
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
            z-index: 50;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 0 0 10px 10px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 1000px) {
            .content {
                flex-direction: column;
            }
            
            .info-panel {
                flex: 1;
            }
            
            .electrode-label {
                font-size: 1.8rem;
                width: 40px;
                height: 40px;
            }
            
            .particle-description {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="content">
            <div class="visualization">
                <div class="particle-description">
                    欧姆定律粒子流学习平台：动态电子流展示电流方向
                </div>
                <canvas id="three-canvas"></canvas>
                <!-- 缩小后的正负电极标签 -->
                <div class="electrode-label positive-label" id="positive-label" style="top: 60%; right: 12%;">+</div>
                <div class="electrode-label negative-label" id="negative-label" style="top: 60%; left: 12%;">-</div>
            </div>
            
            <div class="info-panel">
                <h2 class="panel-title">核心知识点</h2>
                <ul class="knowledge-points">
                    <li><span class="highlight">欧姆定律的特性方程</span>描述了两个关系：电流方向与电压极性，以及电流大小与电压大小</li>
                    <li>参考方向配合会影响方程形式：<span class="highlight">无源惯例</span>表达式为 <span class="highlight">u = R i</span></li>
                    <li>非无源惯例表达式为 <span class="highlight">u = -R i</span>，负号保证电压极性与电流方向一致</li>
                    <li>习惯采用 <span class="highlight">u = R i</span> 作为电阻元件特性方程的表示式</li>
                    <li><span class="highlight">线性电阻</span>：电流和电压成正比，满足 u ∝ i 关系</li>
                    <li>方程中的负号是为了保持电压极性与电流方向的一致性</li>
                </ul>
                
                <div class="controls">
                    <h3>交互控制</h3>
                    <div class="control-group">
                        <button id="passive-btn" class="btn active">无源惯例 (u = R i)</button>
                        <button id="active-btn" class="btn">非无源惯例 (u = -R i)</button>
                        <button id="reverse-btn" class="btn">反转电流方向</button>
                        <button id="animate-btn" class="btn">启动粒子流</button>
                    </div>
                    
                    <div class="speed-control">
                        <div class="slider-container">
                            <label>粒子速度:</label>
                            <input type="range" id="particle-speed" min="1" max="10" value="5">
                            <label id="speed-value">5</label>
                        </div>
                    </div>
                </div>
                
                <div class="formula-display">
                    <h3>当前特性方程</h3>
                    <div id="current-formula" class="formula">u = R i</div>
                    <p>采用无源惯例：电压与电流方向相同</p>
                    
                    <div class="formula-legend">
                        <div class="legend-item">
                            <div class="legend-color current-color"></div>
                            <span>电流方向 (i)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color voltage-color"></div>
                            <span>电压极性 (u)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color particle-color"></div>
                            <span>电子流</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 主Three.js场景初始化
        let scene, camera, renderer, controls;
        let resistor, currentArrow, voltageArrow;
        let passiveConvention = true;
        let animateCurrent = true;
        let particleSpeed = 5;
        
        // 粒子系统变量
        let particleSystem;
        let particles = [];
        const particleCount = 500;
        
        // 初始化场景
        function init() {
            // 创建场景
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB); // 浅蓝色背景
            
            // 创建相机
            const canvas = document.getElementById('three-canvas');
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            
            camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 1000);
            camera.position.set(0, 4, 8);
            camera.lookAt(0, 0, 0);
            
            // 创建渲染器
            renderer = new THREE.WebGLRenderer({ 
                canvas, 
                antialias: true,
                alpha: false
            });
            renderer.setSize(width, height);
            renderer.shadowMap.enabled = true;
            renderer.setPixelRatio(window.devicePixelRatio);
            
            // 添加轨道控制器
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // 添加灯光
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);
            
            const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.9);
            directionalLight1.position.set(5, 8, 5);
            directionalLight1.castShadow = true;
            scene.add(directionalLight1);
            
            const directionalLight2 = new THREE.DirectionalLight(0x64b5f6, 0.4);
            directionalLight2.position.set(-5, 3, -3);
            scene.add(directionalLight2);
            
            // 创建电阻模型
            createResistor();
            
            // 创建粒子系统
            createParticleSystem();
            
            // 初始创建箭头
            updateArrows();
            
            // 添加事件监听器
            setupEventListeners();
            
            // 更新电极位置
            updateElectrodeLabels();
            
            // 开始动画循环
            animate();
        }
        
        // 创建电阻模型
        function createResistor() {
            const resistorGroup = new THREE.Group();
            resistorGroup.name = "ResistorGroup";
            
            // 主圆柱体（电阻）
            const geometry = new THREE.CylinderGeometry(0.8, 0.8, 3, 32);
            const material = new THREE.MeshStandardMaterial({ 
                color: 0x795548, 
                metalness: 0.3,
                roughness: 0.7
            });
            resistor = new THREE.Mesh(geometry, material);
            resistor.castShadow = true;
            resistor.receiveShadow = true;
            resistor.rotation.z = Math.PI/2;
            
            // 金属端帽
            const capGeometry = new THREE.CylinderGeometry(0.4, 0.4, 0.4, 32);
            const capMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x90a4ae, 
                metalness: 0.8,
                roughness: 0.2
            });
            
            const capLeft = new THREE.Mesh(capGeometry, capMaterial);
            capLeft.position.x = -1.7;
            capLeft.castShadow = true;
            capLeft.rotation.z = Math.PI/2;
            
            const capRight = new THREE.Mesh(capGeometry, capMaterial);
            capRight.position.x = 1.7;
            capRight.castShadow = true;
            capRight.rotation.z = Math.PI/2;
            
            // 导线
            const wireGeometry = new THREE.CylinderGeometry(0.1, 0.1, 6, 8);
            const wireMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xb0bec5, 
                metalness: 0.9,
                roughness: 0.1
            });
            
            const wireLeft = new THREE.Mesh(wireGeometry, wireMaterial);
            wireLeft.position.x = -3.5;
            wireLeft.rotation.z = Math.PI/2;
            wireLeft.castShadow = true;
            
            const wireRight = new THREE.Mesh(wireGeometry, wireMaterial);
            wireRight.position.x = 3.5;
            wireRight.rotation.z = Math.PI/2;
            wireRight.castShadow = true;
            
            // 添加所有部件到组
            resistorGroup.add(resistor);
            resistorGroup.add(capLeft);
            resistorGroup.add(capRight);
            resistorGroup.add(wireLeft);
            resistorGroup.add(wireRight);
            
            scene.add(resistorGroup);
        }
        
        // 创建粒子系统（橙黄色粒子）
        function createParticleSystem() {
            const particleGeometry = new THREE.BufferGeometry();
            const particleMaterial = new THREE.PointsMaterial({
                color: 0xFFA500, // 橙黄色粒子
                size: 0.12,
                transparent: true,
                opacity: 0.9,
                blending: THREE.AdditiveBlending,
                sizeAttenuation: true
            });
            
            // 初始化粒子位置
            const posArray = new Float32Array(particleCount * 3);
            
            for (let i = 0; i < particleCount * 3; i += 3) {
                // 粒子分布在两端导线上
                const segment = Math.random() > 0.5 ? 0 : 1; 
                
                if (segment === 0) {
                    // 左侧导线粒子
                    posArray[i] = Math.random() * 2 - 4.5; 
                } else {
                    // 右侧导线粒子
                    posArray[i] = Math.random() * 2 + 2.5;
                }
                posArray[i+1] = (Math.random() - 0.5) * 0.2;
                posArray[i+2] = (Math.random() - 0.5) * 0.2;
                
                particles.push({
                    speed: (Math.random() * 0.02 + 0.01) * particleSpeed,
                    baseX: posArray[i],
                    baseY: posArray[i+1],
                    baseZ: posArray[i+2],
                    originalX: posArray[i],
                    brightness: Math.random() * 0.5 + 0.5
                });
            }
            
            particleGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            particleSystem = new THREE.Points(particleGeometry, particleMaterial);
            scene.add(particleSystem);
        }
        
        // 更新粒子系统
        function updateParticles() {
            const positions = particleSystem.geometry.attributes.position.array;
            const direction = passiveConvention ? 1 : -1;
            const time = Date.now() * 0.001;
            
            for (let i = 0; i < particles.length; i++) {
                const p = particles[i];
                
                // 根据当前模式和方向更新位置
                if (animateCurrent) {
                    p.baseX += p.speed * direction;
                    
                    // 如果粒子移出导线范围，重置位置
                    if ((passiveConvention && p.baseX > 5.5) || (!passiveConvention && p.baseX < -5.5)) {
                        p.baseX = passiveConvention ? -5.5 : 5.5;
                    }
                }
                
                // 粒子波动效果
                p.baseY = (Math.sin(time * 2 + p.originalX) * 0.1) - 0.05;
                p.baseZ = (Math.cos(time * 2 + p.originalX) * 0.1) - 0.05;
                
                // 更新粒子位置
                positions[i * 3] = p.baseX;
                positions[i * 3 + 1] = p.baseY;
                positions[i * 3 + 2] = p.baseZ;
            }
            
            particleSystem.geometry.attributes.position.needsUpdate = true;
        }
        
        // 创建电压电流指示箭头
        function createArrows() {
            if (currentArrow) scene.remove(currentArrow);
            if (voltageArrow) scene.remove(voltageArrow);
            
            const arrowLength = 2;
            const arrowHeadLength = 0.5;
            const arrowHeadWidth = 0.3;
            
            // 电流方向箭头 (红色)
            const currentDir = passiveConvention ? new THREE.Vector3(1, 0, 0) : new THREE.Vector3(-1, 0, 0);
            currentArrow = new THREE.ArrowHelper(
                currentDir.clone().normalize(),
                passiveConvention ? new THREE.Vector3(-3, 1.2, 0) : new THREE.Vector3(3, 1.2, 0),
                arrowLength,
                0xe74c3c,
                arrowHeadLength,
                arrowHeadWidth
            );
            
            // 电压极性箭头 (蓝色)
            const voltageDir = passiveConvention ? new THREE.Vector3(1, 0, 0) : new THREE.Vector3(-1, 0, 0);
            voltageArrow = new THREE.ArrowHelper(
                voltageDir.clone().normalize(),
                new THREE.Vector3(0, -1.2, 0),
                arrowLength,
                0x3498db,
                arrowHeadLength,
                arrowHeadWidth
            );
            
            scene.add(currentArrow);
            scene.add(voltageArrow);
        }
        
        // 更新箭头显示
        function updateArrows() {
            createArrows();
            
            // 更新公式显示
            const formulaElement = document.getElementById('current-formula');
            formulaElement.textContent = passiveConvention ? "u = R i" : "u = - R i";
            
            // 更新按钮状态
            document.getElementById('passive-btn').classList.toggle('active', passiveConvention);
            document.getElementById('active-btn').classList.toggle('active', !passiveConvention);
            
            // 更新电极位置
            updateElectrodeLabels();
        }
        
        // 更新电极标签位置
        function updateElectrodeLabels() {
            // 获取电阻在屏幕上的位置
            const resistorPos = new THREE.Vector3(0, 0, 0);
            const canvas = renderer.domElement;
            
            // 将3D位置转换为屏幕坐标
            resistorPos.project(camera);
            const x = (resistorPos.x * 0.5 + 0.5) * canvas.width;
            const y = (-resistorPos.y * 0.5 + 0.5) * canvas.height;
            
            // 获取正负极标签元素
            const positiveLabel = document.getElementById('positive-label');
            const negativeLabel = document.getElementById('negative-label');
            
            // 根据当前模式调整标签位置
            if (passiveConvention) {
                // 常规模式：正极在右侧，负极在左侧
                positiveLabel.style.left = (x / canvas.width * 100 + 12) + '%';
                negativeLabel.style.left = (x / canvas.width * 100 - 12) + '%';
            } else {
                // 反转模式：正极在左侧，负极在右侧
                positiveLabel.style.left = (x / canvas.width * 100 - 12) + '%';
                negativeLabel.style.left = (x / canvas.width * 100 + 12) + '%';
            }
            
            // 设置垂直位置
            positiveLabel.style.top = (y / canvas.height * 100 + 2) + '%';
            negativeLabel.style.top = (y / canvas.height * 100 + 2) + '%';
        }
        
        // 设置事件监听
        function setupEventListeners() {
            document.getElementById('passive-btn').addEventListener('click', () => {
                passiveConvention = true;
                updateArrows();
            });
            
            document.getElementById('active-btn').addEventListener('click', () => {
                passiveConvention = false;
                updateArrows();
            });
            
            document.getElementById('reverse-btn').addEventListener('click', () => {
                passiveConvention = !passiveConvention;
                updateArrows();
            });
            
            document.getElementById('animate-btn').addEventListener('click', function() {
                animateCurrent = !animateCurrent;
                this.textContent = animateCurrent ? "暂停粒子流" : "启动粒子流";
            });
            
            // 粒子速度控制
            const speedSlider = document.getElementById('particle-speed');
            const speedValue = document.getElementById('speed-value');
            
            speedSlider.addEventListener('input', function() {
                particleSpeed = parseInt(this.value);
                speedValue.textContent = particleSpeed;
                
                // 更新所有粒子的速度
                particles.forEach(p => {
                    p.speed = (Math.random() * 0.02 + 0.01) * particleSpeed;
                });
            });
            
            // 窗口大小改变时调整渲染器和标签
            window.addEventListener('resize', () => {
                const canvas = document.getElementById('three-canvas');
                camera.aspect = canvas.clientWidth / canvas.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(canvas.clientWidth, canvas.clientHeight);
                
                // 更新电极标签位置
                updateElectrodeLabels();
            });
            
            // 当相机移动时更新电极标签位置
            controls.addEventListener('change', () => {
                updateElectrodeLabels();
            });
        }
        
        // 动画循环
        function animate() {
            requestAnimationFrame(animate);
            
            // 更新粒子系统
            updateParticles();
            
            // 更新控制器
            controls.update();
            
            // 渲染场景
            renderer.render(scene, camera);
        }
        
        // 启动应用
        window.onload = init;
    </script>
</body>
</html>